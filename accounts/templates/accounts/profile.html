{% extends "core/base.html" %}
{% load custom_filters %}

{% block page-header %}
  User Profile
{% endblock %}

{% block content %}

<div id="profile-menu-content" style="display: flex; width: 100%; margin-top: -10px;">

    <!-- Navigation Menu -->
    <div id="profile-menu" style="width: 15%;">
        <a href="#" onclick="showContent('user', 'Profile > Data')" style="text-decoration-line: underline; color: blue;">Data</a>
        <a href="#" onclick="showContent('customer', 'Profile > Sizes')" style="text-decoration-line: underline; color: blue;">Sizes</a>
        <a href="#" onclick="showContent('likes', 'Profile > Likes')" style="text-decoration-line: underline; color: blue;">Likes</a>
        <br>
        <a href="#" onclick="showContent('upload', 'Profile > Upload')" style="text-decoration-line: underline; color: blue;">Upload</a>
        <a href="#" onclick="showContent('settings', 'Profile > Settings')" style="text-decoration-line: underline; color: blue;">Settings</a>
        <a href="#" onclick="showContent('cart', 'Profile > Cart')" style="text-decoration-line: underline; color: blue;">Cart</a>
        <br>
        <form method="post" action="{% url 'accounts:logout' %}" style="display: inline;">
        {% csrf_token %}
        <button type="submit" class="nav-link logout-button">Logout</button>
        </form>
    </div>

    <!-- Content Area -->
    <div id="content" style="width: 70%; padding-left: 5px; margin-top: -16px; text-align: left; display: flex; align-items: flex-start;">
        <!-- Default Welcome Message -->
        <div id="default" class="content-section" style="display: block; margin-top: 40px;">
            {% include "accounts/public_profile_content.html" with profile_user=user is_own_profile=True is_following=False %}
        </div>

        <!-- User Profile Section -->
        <div id="user" class="content-section" style="display: none; padding: 10px;">
            {% if editing %}
                <form method="post" action="{% url 'accounts:profile' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <p style="margin-top: 7px; text-align: left;">
                        Username: @{{ user_form.username }}<br>
                        Email: {{ user_form.email }}<br>
                        <br>
                        <label for="id_pfp">Profile Picture: </label>
                        <input type="file" name="pfp" id="id_pfp"><br><br>
                        Bio: {{ user_form.bio }}<br>
                        <br>
                        Credits: {{ user.credits }}<br>
                        <br>
                    </p>
                    <input type="hidden" name="user_form" value="user_form">
                    <button type="submit">Save changes</button>
                </form>
            {% else %}
                <p style="margin-top: 7px; text-align: left;">
                    Username: @{{ user.username }}<br>
                    Email: {{ user.email }}<br>
                    <br>
                    Profile Picture: {{ user.pfp.url|filename }}<br>
                    <br>
                    Bio: {{ user.bio }}<br>
                    <br>
                    Credits: {{ user.credits }}<br>
                    <br>
                </p>
                <form method="get" action="{% url 'accounts:profile' %}">
                    <input type="hidden" name="edit" value="user">
                    <button type="submit" name="edit" value="true">Edit</button>
                </form>
            {% endif %}
        </div>

        <!-- Customer Profile Section -->
        <div id="customer" class="content-section" style="display: none;">
            {% if editing %}
                <form method="post" action="{% url 'accounts:profile' %}">
                    {% csrf_token %}
                    <p>
                        Top: {{ customer_form.top_size_xyz }}<br>
                        Bottom: {{ customer_form.bottom_size_xyz }}<br>
                        Waist (inches): {{ customer_form.size_waist_inches }}<br>
                        Shoe (EU): {{ customer_form.shoe_size_eu }}<br>
                        Shoe (UK): {{ customer_form.shoe_size_uk }}<br>
                        <br>
                        {{ customer_form.height.label_tag }} {{ customer_form.height }}<br>
                        {{ customer_form.weight.label_tag }} {{ customer_form.weight }}<br>
                    </p>
                    <input type="hidden" name="customer_form" value="customer_form">
                    <button type="submit">Save changes</button>
                </form>
            {% else %}
                <p style="margin-top: 15px;">
                    Top: {{ user.customer.top_size_xyz }}<br>
                    Bottom: {{ user.customer.bottom_size_xyz }}<br>
                    Waist (inches): {{ user.customer.size_waist_inches }}<br>
                    Shoe (EU): {{ user.customer.shoe_size_eu }}<br>
                    Shoe (UK): {{ user.customer.shoe_size_uk }}<br>
                    <br>
                    Height: {{ user.customer.height }} cm<br>
                    Weight: {{ user.customer.weight }} kg<br>
                </p>
                <form method="get" action="{% url 'accounts:profile' %}">
                    <input type="hidden" name="edit" value="customer">
                    <button type="submit" name="edit" value="true">Edit</button>
                </form>
            {% endif %}
        </div>

        <!-- Likes Profile Section -->
        <div id="likes" class="content-section" style="display: none;">
            <p style="margin-top: 15px; text-align: left;">
                Empty
            </p>
        </div>



        <!-- Cart Profile Section -->
        <div id="cart" class="content-section" style="display: none;">
            <p style="margin-top: 15px; text-align: left;">
                Empty
            </p>
        </div>

        <!-- Upload Profile Section -->
        <div id="upload" class="content-section" style="display: none;">
            <p style="margin-top: 15px; text-align: left;">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ portrait_upload_form.as_p }}
                    <button type="submit" name="portrait_upload_form">Submit</button>
                </form>
            </p>
        </div>

        <!-- Settings Section -->
        <div id="settings" class="content-section" style="display: none;">
            {% if editing_settings %}
                <form method="post" action="{% url 'accounts:profile' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <p style="margin-top: 15px; text-align: left;">
                        <label for="id_profile_visibility">Profile Visibility: </label>
                        {{ profile_settings_form.profile_visibility }}<br>
                        <br>

                        <label for="id_trending_mode">Trending Mode: </label>
                        {{ profile_settings_form.trending_mode }}<br>
                        <br>

                        <label for="id_trending_styles">Trending Styles: </label><br>
                        <div>
                            {% for style in available_styles %}
                                <label>
                                    <input type="checkbox" name="trending_styles" value="{{ style.id }}"
                                           {% if style in user_trending_styles %}checked{% endif %}>
                                    {{ style.style_name }}
                                </label><br>
                            {% endfor %}
                        </div>

                        <br>
                        *Studio Location: London<br>
                        *Studio Style: Indie<br>
                        <br>
                    </p>
                    <input type="hidden" name="profile_settings_form" value="profile_settings_form">
                    <button type="submit">Save changes</button>
                </form>
            {% else %}
                <p style="margin-top: 15px; text-align: left;">
                    Profile Visibility: {{ user.get_profile_visibility_display }}<br>
                    <br>
                    Trending Mode: {{ user.get_trending_mode_display }}<br>
                    <br>
                    Trending Styles:
                    {% for style in user.trending_styles.all %}
                        {{ style.style_name }}{% if not forloop.last %} {% endif %}
                    {% endfor %}<br>
                    <br>
                    *Studio Location: London<br>
                    *Studio Styles: Indie<br>
                    <br>
                </p>
                <form method="get" action="{% url 'accounts:profile' %}">
                    <input type="hidden" name="edit_settings" value="true">
                    <button type="submit" name="edit_settings" value="true">Edit</button>
                </form>
            {% endif %}
        </div>

    </div>

    <div id="empty-area" style="width: 15%;">
    </div>
</div>












<script>
    document.addEventListener("DOMContentLoaded", function() {
        const urlParams = new URLSearchParams(window.location.search);
        const editSection = urlParams.get('edit');
        const editSettings = urlParams.get('edit_settings');

        if (editSection) {
            showContent(editSection, `Profile > ${editSection.charAt(0).toUpperCase() + editSection.slice(1)}`);
        } else if (editSettings) {
            showContent('settings', 'Profile > Settings');
        } else {
            showContent('user', 'Profile > User'); // Default section
        }
    });

    function showContent(sectionId, headerText) {
        var sections = document.querySelectorAll('.content-section');
        sections.forEach(function(section) {
            section.style.display = 'none';
        });
        var section = document.getElementById(sectionId);
        if (section) {
            section.style.display = 'block';
            document.getElementById('page-header').textContent = headerText;
        }
    }
</script>








<style>
    #profile-menu a {
        display: block;
        margin-bottom: 5px; /* Ensure each link is on its own line */
        text-align: left;
    }

    @media (max-width: 768px) {
        #empty-area {
            width: 5% !important;
        }

        #profile-menu {
            width: 15%;
            flex-direction: row;
            overflow-x: auto;
            margin-right: 15px;
            padding-right: 17px;
            margin-top: 0px;
        }
        #profile-menu a {
            flex: 1;
            border-bottom: none;
        }
        #content {
            width: 100%;
            padding-left: 0px;
            margin-top: 0;
        }

        #profile-menu-content {
            margin-left:-15px
            width: 115%
        }
    }
</style>

{% endblock %}
