{% extends "core/base.html" %}

{% block page-header %}
  Studio
{% endblock %}

{% block content %}

<!-- ERROR MESSAGE -->
{% if messages %}
    <div class="error-messages" style="color: red; margin-top: -25px; text-align: center;">
        {% for message in messages %}
            <p>{{ message }}</p>
        {% endfor %}
    </div>
{% endif %}

<!-- TICKET LINE -->
<table id="studio-tickets-table">
    <thead>
        <tr>
            <th>Style</th>
            <th>Occasion</th>
            <th>Notes</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>{{ ticket.style1 }}</td>
            <td>{{ ticket.occasion }}</td>
            <td>{{ ticket.notes }}</td>
        </tr>
    </tbody>
</table>

<p>Your <strong>Outfit</strong> for Ticket #{{ ticket.id }}</p>

<!-- FINAL OUTFIT IMAGES (TEMP) -->
<div id="contB">
    {% for url in image_urls %}
    <div class="contA">
        <img src="{{ url }}" alt="Item image">
        <a href="{% url 'studio:studio_items_reset' ticket.id forloop.counter %}">Remove</a>
    </div>
    {% endfor %}
</div>

<!-- GAP -->
<p></p>

{% comment %}
<!-- SUBMIT OUTFIT BUTTON -->
<form method="post" action="{% url 'studio:submit_outfit' ticket.id %}">
    {% csrf_token %}
    <button type="submit">Submit Outfit</button>
</form>
{% endcomment %}
<form method="post" action="{% url 'studio:submit_outfit' ticket.id %}" id="submit-outfit-form">
    {% csrf_token %}
    <button type="submit" id="submit-button">Submit Outfit</button>
</form>


<!-- GAP -->
<p></p>

<!-- SEARCH FORM -->
<form method="GET" action="{% url 'studio:item_search' ticket.id %}">
    <input type="text" name="search_query" placeholder='"blue" "shirt" "stripes"'>
    <button type="submit">Search Clothes</button>
</form>

<p></p>

<!-- DISPLAY SEARCH RESULTS -->
<div id="contB">
    {% for item in items %}
    <div class="contA">
        <img src="{{ item.image.url }}" alt="Item Image">
        <form action="{% url 'studio:add_item_to_temp' %}" method="POST">
            {% csrf_token %}
            <input type="hidden" name="item_itemid" value="{{ item.itemid }}">
            <input type="hidden" name="item_cat" value="{{ item.cat }}">
            <input type="hidden" name="ticket_id" value="{{ ticket.id }}">
            <button type="submit" class="link-style">Add</button>
        </form>
    </div>
    {% endfor %}
</div>








<script>
document.getElementById('submit-outfit-form').addEventListener('submit', function(event) {
    var submitButton = document.getElementById('submit-button');
    var loadingTexts = ['Submitting.', 'Submitting..', 'Submitting...'];
    var currentIndex = 0;

    submitButton.disabled = true; // Disable the button to prevent multiple submissions

    var interval = setInterval(function() {
        submitButton.innerText = loadingTexts[currentIndex];
        currentIndex = (currentIndex + 1) % loadingTexts.length;
    }, 500);

    // Listen for page unload event
    window.addEventListener('beforeunload', function () {
        clearInterval(interval); // Clear the interval if the page unloads
    });

    // Allow the form to submit
    setTimeout(function() {
        document.getElementById('submit-outfit-form').submit();
    }, 100);
});
</script>







<style>
    #contB {
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* 1x4 layout in desktop */
        grid-gap: 2px;
        border: 0px solid black; /* Border around the entire container */
        margin: 0 0px; /* extra margins on the left and right (exei hdh 20px apo body) */
    }

    .contA {
        display: flex;
        flex-direction: column; /* Image on top, link on bottom */
        border: 1px solid black; /* Thin borders as specified, like regular table lines */
    }

    .contA img {
        width: 100%;
        height: auto;
        flex-grow: 1; /* Image takes up the available space */
    }

    .contA a {
        text-align: center;
        padding: 10px;
        background: white;
        border-top: 1px solid black; /* Thin border between image and link */
        display: block;
    }

    @media (max-width: 768px) {
        #contB {
            grid-template-columns: repeat(2, 1fr); /* 2x2 layout in mobile */
        }
    }

    /* kanw fake to button san link */
    .link-style {
        background: none;
        border: none;
        color: blue;
        text-decoration: underline;
        cursor: pointer;
        display: block;
        text-align: center;
        padding: 10px; /* Adjust padding to match 'Remove' link */
        width: 100%;
        font-family: inherit; /* Inherit the font family from parent elements */
        font-size: inherit; /* Optionally ensure the font size is also inherited */
        border-top: 1px solid black; /* kanonika einai sto contA a alla edw */
    }
</style>

{% endblock %}
